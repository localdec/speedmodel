---
redirect_from:
  - "/getvelocityparameters"
interact_link: content/GetVelocityParameters.ipynb
kernel_name: python3
kernel_path: content
has_widgets: false
title: |-
  Collection of frequency and peak velocity parameters from all pipelines
pagenum: 1
prev_page:
  url: /Exploratory.html
next_page:
  url: /AllPipelines.html
suffix: .ipynb
search: gemini mfl rosen c velocity bh peaks emat match afd data peak predict not frequency parameters excursions plot conclusion threshold predicts pipelines rosetta tool pipeline read confirm above examine nicpma mark inverted max zero estimate collection already closely bhge purpose workbook sense stones thus our hypothesis though series correlations speed create dictionary spreadsheet parmeters excel interest invert plots suggest inversely correlated quick raw does however inverse below intermediate very little correlation between bhi clear much predicting ultimately start using existing benchmark worth mapping afl cannot serve stone link tools together try profile get min transformation newvelocity previous new redo iterative

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Collection of frequency and peak velocity parameters from all pipelines</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We already have velocity parameters that closely match the number of peaks of the Rosen EMAT with:</p>
<ul>
<li>Rosen MFL-C</li>
<li>BHGE-MFL</li>
</ul>
<p>The purpose of this workbook is to find velocity parameters to:</p>
<ul>
<li>Match the BH(I) Gemini with Rosen MFL-C</li>
<li>Match the Rosen AFD with the BH(I) Gemini</li>
</ul>
<p>In this sense, the the BH(I) Gemini and Rosen MFL-C are the "Rosetta Stones":</p>
<ul>
<li>Rosen AFD can predict BH(I) Gemini</li>
<li>BH(I) Gemini can predict Rosen MFL-C</li>
<li>Rosen MFL-C can predict EMAT</li>
</ul>
<p>Thus: our hypothesis is that we can use velocity data from the Rosen AFD to, though a series of correlations, predict the number of speed excursions for the Rosen EMAT</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">localdec</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;../SpeedData&quot;</span>
<span class="n">dist_col</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">pls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span>  <span class="s2">&quot;Datasets.xlsx&quot;</span><span class="p">,</span>
                        <span class="n">sheet_name</span> <span class="o">=</span> <span class="s2">&quot;Datasets&quot;</span><span class="p">)</span>
<span class="n">pls</span><span class="p">[</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pls</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;^(.*)\sVelocity.*&quot;</span><span class="p">)</span>
<span class="n">pls</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pls</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PiplineNo</th>
      <th>Filename</th>
      <th>Sheet</th>
      <th>Header</th>
      <th>Skip</th>
      <th>SpeedData1</th>
      <th>SpeedData2</th>
      <th>SpeedData3</th>
      <th>Tool1</th>
      <th>Tool2</th>
      <th>Tool3</th>
      <th>PredictorTool</th>
    </tr>
    <tr>
      <th>Pipeline</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CH-NC_508</th>
      <td>1</td>
      <td>CH-NC_508 Velocity Excursion Review.xlsm</td>
      <td>Sheet1</td>
      <td>4</td>
      <td>5</td>
      <td>7</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>Velocity \n(2019 BHGE GEMINI MFL)</td>
      <td>Velocity \n(2013 ROSEN AFD )</td>
      <td>NaN</td>
      <td>ROSEN AFD</td>
    </tr>
    <tr>
      <th>LIV_PAT_457</th>
      <td>2</td>
      <td>LIV_PAT_457 Velocity Excursion Review.xlsm</td>
      <td>Event Log &amp; Velocity Listing</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7.0</td>
      <td>8.0</td>
      <td>Velocity (2019 BHGE MFL)</td>
      <td>Velocity (2019 ROSEN MFL-C)</td>
      <td>Velocity (2019 ROSEN EMAT (wSC))</td>
      <td>ROSEN EMAT (wSC)</td>
    </tr>
    <tr>
      <th>HUN_NIC_762</th>
      <td>3</td>
      <td>HUN_NIC_762 Velocity Excursion Review.xlsm</td>
      <td>Sheet1</td>
      <td>4</td>
      <td>5</td>
      <td>7</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>Velocity \n(2016 BH Gemini HD MFL (wSC))</td>
      <td>Velocity \n(2017 ROSEN AFD )</td>
      <td>NaN</td>
      <td>ROSEN AFD</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-tool-dictionary-from-pipeline-spreadsheet">Create tool dictionary from pipeline spreadsheet<a class="anchor-link" href="#Create-tool-dictionary-from-pipeline-spreadsheet"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipelines</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">colheads</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(^SpeedData\d)&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">toolheads</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;(^Tool\d)&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>
<span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">pls</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tools</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">toolhead</span> <span class="ow">in</span> <span class="n">toolheads</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="n">toolhead</span><span class="p">]</span> <span class="o">==</span> <span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="n">toolhead</span><span class="p">]:</span>
            <span class="n">tcol</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="n">colheads</span><span class="p">[</span><span class="n">i</span><span class="p">]])}</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Velocity\s*\(\d</span><span class="si">{4}</span><span class="s2">(.*)\)$&quot;</span><span class="p">,</span> <span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="n">toolhead</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">tools</span><span class="p">[</span><span class="n">toolname</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcol</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pipeline</span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span>
    <span class="n">pipelines</span><span class="p">[</span><span class="n">pl</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-tool-parmeters-from-Excel">Read tool parmeters from Excel<a class="anchor-link" href="#Read-tool-parmeters-from-Excel"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool_params</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span>  <span class="s2">&quot;Datasets.xlsx&quot;</span><span class="p">,</span>
                   <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>
<span class="n">tool_params</span><span class="p">[</span><span class="s2">&quot;ToolName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_params</span><span class="p">[</span><span class="s2">&quot;ToolName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">tool_params</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ToolName&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tool_params</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Degrade</th>
      <th>Blind</th>
      <th>Peak</th>
      <th>Comment</th>
    </tr>
    <tr>
      <th>ToolName</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ROSEN EMAT (WSC)</th>
      <td>2.5</td>
      <td>4.0</td>
      <td>4.00</td>
      <td>Actual</td>
    </tr>
    <tr>
      <th>ROSEN MFL-C</th>
      <td>4.5</td>
      <td>7.0</td>
      <td>3.60</td>
      <td>Good match</td>
    </tr>
    <tr>
      <th>BHGE MFL</th>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.60</td>
      <td>Okay match</td>
    </tr>
    <tr>
      <th>BH MFL</th>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.60</td>
      <td>Okay match</td>
    </tr>
    <tr>
      <th>BHI GEMINI HD MFL (WSC)</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.45</td>
      <td>Inverted match, weak</td>
    </tr>
    <tr>
      <th>BH GEMINI HD MFL (WSC)</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.45</td>
      <td>Inverted match, weak</td>
    </tr>
    <tr>
      <th>ROSEN AFD</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.70</td>
      <td>Match unknown</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-data-for-pipelines-of-interest">Read data for pipelines of interest<a class="anchor-link" href="#Read-data-for-pipelines-of-interest"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NIC_PMA_610&quot;</span><span class="p">,</span> <span class="s2">&quot;HUN_NIC_762&quot;</span><span class="p">]</span>  <span class="c1"># only read for two pipelines of interest</span>
<span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pl_list</span><span class="p">:</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dist_col</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">tool</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">+</span>  <span class="p">[</span><span class="n">tool</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">data_skiprows</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;Skip&quot;</span><span class="p">]):</span>
        <span class="n">data_skiprows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;Skip&quot;</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
    <span class="n">pl_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;Filename&quot;</span><span class="p">],</span>
                   <span class="n">sheet_name</span><span class="o">=</span><span class="n">pls</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;Sheet&quot;</span><span class="p">],</span>
                   <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
                   <span class="n">names</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">,</span>
                   <span class="n">skiprows</span><span class="o">=</span><span class="n">data_skiprows</span><span class="p">)</span>
    <span class="n">pl_raw</span> <span class="o">=</span> <span class="n">pl_raw</span><span class="p">[</span><span class="n">pl_raw</span><span class="o">.</span><span class="n">duplicated</span><span class="p">([</span><span class="s2">&quot;Distance&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">]</span>
    <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl_raw</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>NIC_PMA_610
HUN_NIC_762
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plot-to-confirm">Plot to confirm<a class="anchor-link" href="#Plot-to-confirm"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pl_list</span><span class="p">:</span>
    <span class="n">pl_raw</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">pl_raw</span><span class="p">,</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pl</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;tool speed&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>NIC_PMA_610
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_10_1.png"
>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>HUN_NIC_762
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_10_3.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Invert-Gemini?">Invert Gemini?<a class="anchor-link" href="#Invert-Gemini?"> </a></h3><p>The plots above suggest that the Gemini is <em>inversely</em> correlated with the Rosen MFL-C.  A quick plot of the raw data does not confirm this.  However, we examine examine the <em>peaks</em> of the inverse below.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl_raw</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Distance</th>
      <th>BHI GEMINI HD MFL (WSC)</th>
      <th>ROSEN MFL-C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.514230</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.675838</td>
      <td>0.2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.832144</td>
      <td>0.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.827121</td>
      <td>0.5</td>
      <td>2.05</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.348656</td>
      <td>0.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>548</th>
      <td>4959.095216</td>
      <td>1.8</td>
      <td>0.95</td>
    </tr>
    <tr>
      <th>549</th>
      <td>4959.256063</td>
      <td>1.7</td>
      <td>2.75</td>
    </tr>
    <tr>
      <th>550</th>
      <td>4963.955866</td>
      <td>3.1</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>551</th>
      <td>4964.118846</td>
      <td>2.8</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>552</th>
      <td>4964.288328</td>
      <td>2.8</td>
      <td>2.00</td>
    </tr>
  </tbody>
</table>
<p>553 rows Ã— 3 columns</p>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">pl_list</span><span class="p">:</span>
    <span class="n">pl_raw</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">pl_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>NIC_PMA_610
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea ">
<pre>&lt;Figure size 720x720 with 0 Axes&gt;</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_13_2.png"
>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>HUN_NIC_762
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_13_4.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Intermediate-conclusion">Intermediate conclusion<a class="anchor-link" href="#Intermediate-conclusion"> </a></h2><p>There is very little correlation between the peaks for the MFL-C and the BHI Gemini.  It is not clear that the Gemini will be much use when predicting the MFL-C and ultimately the EMAT.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Match-peaks-for-NIC_PMA_610">Match peaks for NIC_PMA_610<a class="anchor-link" href="#Match-peaks-for-NIC_PMA_610"> </a></h1><p>The NIC_PMA_610 pipeline has data for the MFL-C and the BH Gemini.  We can start with it.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="s2">&quot;NIC_PMA_610&quot;</span>
<span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;BHI GEMINI HD MFL (WSC)&#39;, &#39;ROSEN MFL-C&#39;])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Mark-the-MFL-C-using-the-existing-benchmark-velocity-threshold">Mark the MFL-C using the existing benchmark velocity threshold<a class="anchor-link" href="#Mark-the-MFL-C-using-the-existing-benchmark-velocity-threshold"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;ROSEN MFL-C&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="n">tool_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Peak&quot;</span><span class="p">]</span>
<span class="n">dist_thresh</span> <span class="o">=</span> <span class="mi">25</span>

<span class="c1"># unpivot data and create temporary dataframe</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ROSEN MFL-C peaks 10.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Match-the-BH(I)-Gemini-with-Rosen-MFL-C">Match the BH(I) Gemini with Rosen MFL-C<a class="anchor-link" href="#Match-the-BH(I)-Gemini-with-Rosen-MFL-C"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;BHI GEMINI HD MFL (WSC)&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="o">.</span><span class="mi">05</span><span class="p">):</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
    <span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tool</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">vals</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.0, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.05, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.1, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.15, 10.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.2, 10.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.25, 7.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.3, 7.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.35, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.4, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.45, 3.0)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;BHI GEMINI HD MFL (WSC)&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="mf">3.15</span> <span class="c1"># selected based on iterations above</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>BHI GEMINI HD MFL (WSC) peaks 10.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plot-peaks">Plot peaks<a class="anchor-link" href="#Plot-peaks"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_23_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h3><p>It is not worth mapping peaks for the BH Gemini and Rosen AFL.  The BH Gemini cannot serve as the "Rosetta Stone" to link these tools together.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Try-inverted-Gemini-profile">Try inverted Gemini profile<a class="anchor-link" href="#Try-inverted-Gemini-profile"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="s2">&quot;NIC_PMA_610&quot;</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-the-min-and-max-velocity-for-the-Gemini">Get the min and max velocity for the Gemini<a class="anchor-link" href="#Get-the-min-and-max-velocity-for-the-Gemini"> </a></h3><p>The transformation is new_velocity = max(velocity) - velocity.  So the previous peak is now zero and zero is the new peak.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)[</span><span class="s2">&quot;Velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)[</span><span class="s2">&quot;Velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Tool
 BHI GEMINI HD MFL (WSC)    3.70
 ROSEN MFL-C                5.85
 Name: Velocity, dtype: float64,
 Tool
 BHI GEMINI HD MFL (WSC)    0.00
 ROSEN MFL-C                0.15
 Name: Velocity, dtype: float64)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.7</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Velocity&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pl</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;tool speed&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_29_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Redo-the-iterative-search-for-threshold-peak-velocity-for-the-inverted-data">Redo the iterative search for threshold peak velocity for the inverted data<a class="anchor-link" href="#Redo-the-iterative-search-for-threshold-peak-velocity-for-the-inverted-data"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;BHI GEMINI HD MFL (WSC)&quot;</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">):</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
    <span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tool</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">vals</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.2, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.25, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.3, 11.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.35, 9.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.4, 9.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.45, 9.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.5, 9.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.55, 8.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.6, 8.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.65, 7.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.7, 7.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.75, 6.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.8, 6.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.85, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.9, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 2.95, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.0, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.05, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.1, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.15, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.2, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.25, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.3, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.35, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.4, 4.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.45, 3.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.5, 3.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.55, 1.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.6, 1.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.65, 1.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.7, 1.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.75, 0.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.8, 0.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.85, 0.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.9, 0.0),
 (&#39;BHI GEMINI HD MFL (WSC)&#39;, 3.95, 0.0)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Mark the Gemini with the selected threshold from above</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;BHI GEMINI HD MFL (WSC)&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="mf">2.35</span> <span class="c1"># selected based on iterations above</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>BHI GEMINI HD MFL (WSC) peaks 9.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Re-run the MFL-C for this dataset</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;ROSEN MFL-C&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="n">tool_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Peak&quot;</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ROSEN MFL-C peaks 10.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_36_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Match-peaks-for-HUN_NIC_762&#182;">Match peaks for HUN_NIC_762&#182;<a class="anchor-link" href="#Match-peaks-for-HUN_NIC_762&#182;"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="s2">&quot;HUN_NIC_762&quot;</span>
<span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;BH GEMINI HD MFL (WSC)&#39;, &#39;ROSEN AFD&#39;])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;BH GEMINI HD MFL (WSC)&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="n">tool_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Peak&quot;</span><span class="p">]</span>

<span class="c1"># unpivot data and create temporary dataframe</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">pipelines</span><span class="p">[</span><span class="n">pipeline</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                <span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
                <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span>
                <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="c1"># invert speed</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.7</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Velocity&quot;</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>BH GEMINI HD MFL (WSC) peaks 6.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;ROSEN AFD&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">):</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
    <span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tool</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="n">vals</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;ROSEN AFD&#39;, 0.5, 1.0),
 (&#39;ROSEN AFD&#39;, 0.51, 2.0),
 (&#39;ROSEN AFD&#39;, 0.52, 2.0),
 (&#39;ROSEN AFD&#39;, 0.53, 2.0),
 (&#39;ROSEN AFD&#39;, 0.54, 2.0),
 (&#39;ROSEN AFD&#39;, 0.55, 2.0),
 (&#39;ROSEN AFD&#39;, 0.56, 2.0),
 (&#39;ROSEN AFD&#39;, 0.57, 2.0),
 (&#39;ROSEN AFD&#39;, 0.58, 2.0),
 (&#39;ROSEN AFD&#39;, 0.59, 2.0),
 (&#39;ROSEN AFD&#39;, 0.6, 2.0),
 (&#39;ROSEN AFD&#39;, 0.61, 2.0),
 (&#39;ROSEN AFD&#39;, 0.62, 2.0),
 (&#39;ROSEN AFD&#39;, 0.63, 2.0),
 (&#39;ROSEN AFD&#39;, 0.64, 2.0),
 (&#39;ROSEN AFD&#39;, 0.65, 3.0),
 (&#39;ROSEN AFD&#39;, 0.66, 3.0),
 (&#39;ROSEN AFD&#39;, 0.67, 3.0),
 (&#39;ROSEN AFD&#39;, 0.68, 3.0),
 (&#39;ROSEN AFD&#39;, 0.69, 3.0),
 (&#39;ROSEN AFD&#39;, 0.7, 5.0),
 (&#39;ROSEN AFD&#39;, 0.71, 5.0),
 (&#39;ROSEN AFD&#39;, 0.72, 5.0),
 (&#39;ROSEN AFD&#39;, 0.73, 5.0),
 (&#39;ROSEN AFD&#39;, 0.74, 5.0),
 (&#39;ROSEN AFD&#39;, 0.75, 5.0),
 (&#39;ROSEN AFD&#39;, 0.76, 5.0),
 (&#39;ROSEN AFD&#39;, 0.77, 5.0),
 (&#39;ROSEN AFD&#39;, 0.78, 5.0),
 (&#39;ROSEN AFD&#39;, 0.79, 5.0),
 (&#39;ROSEN AFD&#39;, 0.8, 8.0)]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tool</span> <span class="o">=</span> <span class="s2">&quot;ROSEN AFD&quot;</span>
<span class="n">peak</span> <span class="o">=</span>  <span class="mf">0.79</span> <span class="c1"># selected based on iterations above</span>
<span class="n">pl</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pl</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tool</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># reset</span>
<span class="n">localdec</span><span class="o">.</span><span class="n">mark_excursion</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> peaks </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Tool&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">tool</span><span class="p">)[</span><span class="s2">&quot;Excursion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ROSEN AFD peaks 5.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Excursion&quot;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s2">&quot;Tool&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/GetVelocityParameters_42_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h1><p>A chained estimate might not work (AFD predicts Gemini predicts MFL-C predicts EMAT).  Perhaps it is better simply to use the AFD excursions to estimate the location of EMAT excursions and to set the frequency per unit length to the observed frequency for the EMAT in LIV_PAT_457.</p>

</div>
</div>
</div>
</div>

 


    </main>
    